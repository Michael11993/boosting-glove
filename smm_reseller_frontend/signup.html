<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Create Account | Boosting Glove</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<style>
:root{--bg:#f6f7fb;--card:#fff;--border:#e6e8f0;--text:#1f2937;--muted:#6b7280;--accent:#ff3d3d;}
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif;}
body{min-height:100vh;background:linear-gradient(120deg,#f9fafb,#eef2ff);display:flex;align-items:center;justify-content:center;color:var(--text);}
.wrapper{width:100%;max-width:1000px;background:var(--card);border-radius:26px;display:grid;grid-template-columns:1fr 1fr;overflow:hidden;box-shadow:0 50px 100px rgba(0,0,0,.08);}
.visual{background: linear-gradient(135deg,rgba(255,61,61,.9),rgba(255,122,61,.85)), url("https://images.unsplash.com/photo-1556761175-4b46a572b786");background-size:cover;background-position:center;padding:60px;color:#fff;display:flex;flex-direction:column;justify-content:center;}
.visual h2{font-size:36px;margin-bottom:14px;}
.visual p{font-size:16px;max-width:380px;opacity:.95;}
.form-side{padding:55px;}
.logo{font-size:24px;font-weight:700;margin-bottom:6px;}
.logo span{color:var(--accent);}
.subtitle{font-size:14px;color:var(--muted);margin-bottom:28px;}
.form-group{margin-bottom:18px;}
.form-group label{display:block;font-size:13px;margin-bottom:6px;color:var(--muted);}
.form-group input{width:100%;padding:14px;border-radius:14px;border:1px solid var(--border);background:#fafafa;outline:none;}
.form-group input:focus{border-color:var(--accent);background:#fff;}
.input-wrap{position:relative;}
.input-wrap input{padding-right:44px;}
.input-wrap i{position:absolute;right:14px;top:50%;transform:translateY(-50%);cursor:pointer;color:#9ca3af;}
.terms{display:flex;gap:10px;align-items:flex-start;font-size:13px;color:var(--muted);margin-bottom:14px;}
.terms input{margin-top:3px;}
.btn{width:100%;margin-top:10px;padding:15px;border:none;border-radius:16px;background:linear-gradient(135deg,var(--accent),#ff7a3d);color:#fff;font-weight:600;font-size:15px;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;}
.btn.loading{pointer-events:none;opacity:.85;}
.spinner{width:18px;height:18px;border:2px solid rgba(255,255,255,.4);border-top-color:#fff;border-radius:50%;animation:spin .8s linear infinite;display:none;}
.btn.loading .spinner{display:block;}
.btn.loading .btn-text{display:none;}
@keyframes spin{to{transform:rotate(360deg);}}
.error{margin-top:14px;font-size:13px;color:#ef4444;text-align:center;display:none;}
.links{text-align:center;margin-top:22px;font-size:13px;}
.links a{color:var(--accent);text-decoration:none;}
@media(max-width:900px){.wrapper{grid-template-columns:1fr;}.visual{display:none;}}
</style>
</head>
<body>

<div class="wrapper">
  <div class="visual">
    <h2>Build Your Growth ðŸš€</h2>
    <p>Create your Boosting Glove account and unlock powerful social media growth tools.</p>
  </div>

  <div class="form-side">
    <div class="logo">Boosting<span>Glove</span></div>
    <div class="subtitle">Create your account</div>

    <form id="signupForm">
      <div class="form-group"><label>Username</label><input id="username" required></div>
      <div class="form-group"><label>Email</label><input id="email" type="email" required></div>
      <div class="form-group"><label>Password</label><div class="input-wrap"><input id="password" type="password" required><i class="fa-solid fa-eye toggle"></i></div></div>
      <div class="form-group"><label>Confirm Password</label><div class="input-wrap"><input id="confirmPassword" type="password" required><i class="fa-solid fa-eye toggle"></i></div></div>
      <div class="terms"><input type="checkbox" id="terms"> <label>I agree to Terms</label></div>
      <button class="btn" id="signupBtn"><span class="btn-text">Create Account</span><span class="spinner"></span></button>
      <div class="error" id="errorMsg"></div>
    </form>

    <div class="links">Already have an account? <a href="login.html">Login</a></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDra5RZapLa5B59MtBO32Vg1qCmAPQnqeQ",
  authDomain: "boosting-glove.firebaseapp.com",
  projectId: "boosting-glove",
  storageBucket: "boosting-glove.firebasestorage.app",
  messagingSenderId: "666485031832",
  appId: "1:666485031832:web:e6fffc638a87a70de761ed"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const form = document.getElementById("signupForm");
const btn = document.getElementById("signupBtn");
const errorMsg = document.getElementById("errorMsg");
const terms = document.getElementById("terms");

form.addEventListener("submit", async (e) => {
  e.preventDefault();
  errorMsg.style.display = "none";
  btn.classList.add("loading");

  const usernameInputValue = document.getElementById("username").value.trim(); // original casing
  const usernameLower = usernameInputValue.toLowerCase(); // lowercase for checking
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value;
  const confirmPassword = document.getElementById("confirmPassword").value;

  if (password !== confirmPassword) { showError("Passwords do not match"); return; }
  if (!terms.checked) { showError("You must agree to the terms"); return; }

  try {
    // Check if username exists
    const usernameRef = doc(db, "usernames", usernameLower);
    const snap = await getDoc(usernameRef);
    if (snap.exists()) throw new Error("Username already taken");

    // Create Auth account
    await createUserWithEmailAndPassword(auth, email, password);

    // Wait for user to be active
    await new Promise(resolve => {
      const unsub = onAuthStateChanged(auth, user => { if(user){ unsub(); resolve(); } });
    });

    const uid = auth.currentUser.uid;

    // Write user profile with original username casing
    await setDoc(doc(db, "users", uid), { username: usernameInputValue, email, balance:0, createdAt: serverTimestamp() });

    // Reserve lowercase username for login lookup
    await setDoc(usernameRef, { uid, email });

    // Save original username for dashboard
    localStorage.setItem("loggedUsername", usernameInputValue);

    // Redirect
    window.location.href = "dashboard.html";

  } catch (err) { showError(err.message); }
});

function showError(msg){ errorMsg.textContent = msg; errorMsg.style.display="block"; btn.classList.remove("loading"); }

// Password toggle
document.querySelectorAll(".toggle").forEach(icon => { icon.onclick=()=>{ const input=icon.previousElementSibling; input.type=input.type==="password"?"text":"password"; icon.classList.toggle("fa-eye-slash"); }; });
</script>

</body>
</html>
